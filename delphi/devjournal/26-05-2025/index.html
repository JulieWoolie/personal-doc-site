<!doctype html><html lang=en><head><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/highlighting.css><link rel=apple-touch-icon sizes=180x180 href=/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><link rel=manifest href=/favicon/site.webmanifest><title>Scripting Expansions</title><meta name=viewport content="width=device-width,initial-scale=1"></head><body class="bg-lighter body"><main class="content content-sizing bg-dark" id=content-el><div class=ppath><a class=ppath-element href=/>Julie's Document Website</a>
<span class=ppath-comma>/</span>
<a class=ppath-element href=/delphi/>Delphi Menu Engine</a>
<span class=ppath-comma>/</span>
<a class=ppath-element href=/delphi/devjournal/>Dev Journal</a>
<span class=ppath-comma>/</span>
<span class=ppath-current>Scripting Expansions</span></div><header class=title-container><img class="headerimg large" src=/delphi/temple.jpg><h1 toc-ignore class=pagetitle>Scripting Expansions</h1><div class=subtitle>25-05-2025</div></header><article id=content><h2>Script expansions</h2><p>I added scheduling functions! <code>setInterval(cb, delay, interval)</code>
and <code>setTimeout(cb, delay)</code> are now supported. But keep in mind,
they take in delays and intervals in ticks, not milliseconds. Both of these
functions return an ID integer that represents their task ID.</p><p>There is of course an accompanying <code>clearTimeout(taskId)</code> to
cancel both interval and timeout tasks.</p><p>This was all made possible with the scheduling API I added to the
<code>DocumentView</code>. This quick little API allows you to schedule tasks
that run after a certain amount of ticks or are run over and over. Once the
view itself is closed, the tasks are closed and don't execute.</p><iframe style=width:100%;height:300px src=https://www.youtube.com/embed/f2bup3f3mMw title="Clicker game,  but made with Display Entities and JS" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy=strict-origin-when-cross-origin allowfullscreen></iframe><h2>Custom Events</h2><p>I also added support for custom events, which I thought might be a good way for
plugins to communicate with menus written with JS, or just a good way to
communicate with menus, really.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>DocumentView</span> <span class=n>view</span> <span class=o>=</span> <span class=cm>/* .. idk */</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=n>Document</span> <span class=n>document</span> <span class=o>=</span> <span class=n>view</span><span class=o>.</span><span class=na>getDocument</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create the event object itself, the only parameter needed, 
</span></span></span><span class=line><span class=cl><span class=c1>// being the event&#39;s type
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>CustomEvent</span> <span class=n>event</span> <span class=o>=</span> <span class=n>document</span><span class=o>.</span><span class=na>newCustomEvent</span><span class=o>(</span><span class=s>&#34;something-happened&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// The &#34;Map.of&#34; can be any map of string to object that contains data 
</span></span></span><span class=line><span class=cl><span class=c1>// for the event.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>event</span><span class=o>.</span><span class=na>initEvent</span><span class=o>(</span><span class=kc>null</span><span class=o>,</span> <span class=kc>false</span><span class=o>,</span> <span class=kc>false</span><span class=o>,</span> <span class=n>Map</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=s>&#34;data&#34;</span><span class=o>,</span> <span class=mi>1</span><span class=o>,</span> <span class=s>&#34;data2&#34;</span><span class=o>,</span> <span class=kc>false</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Then finally, dispatch the event
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>document</span><span class=o>.</span><span class=na>dispatchEvent</span><span class=o>(</span><span class=n>event</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Sidenote: you can access those map properties like this:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Object</span> <span class=n>data</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=na>getProperty</span><span class=o>(</span><span class=s>&#34;data&#34;</span><span class=o>);</span></span></span></code></pre></td></tr></table></div></div><h2>Other</h2><p>There isn't really any other changes, I fixed a weird jerk that would happen when you set a text
node's text content to a text with a different size. For less than a tick, it would be squished
or stretched out before correcting.</p><p>This was happening because the renderer's callback for a text node's content being modified would
directly update that text node's render object. But the actual layout update would happen when
the view's tick method was called, much later. This difference caused a half second of the text
looking smushed or stretched before being updated again.</p></article><script src=/js/images.js></script></main><div class="bg-dark content-sizing footer" style=margin-top:2cm><div class=footer-flex><button class=button id=latex-convert-btn>Copy content as LaTeX</button>
<button class=button id=bg-toggle-btn>Toggle background</button></div><div class=footermsg id=bg-info>Background info:</div><table class=footer-metadata><tbody><tr><td>Author</td><td>Julie</td></tr><tr><td>Publish Date</td><td>2025-26-05 19:29:00 +0200 UTC</td></tr><tr><td>Last Change</td><td>0001-01-01 00:00:00 +0000 UTC</td></tr><tr><td>Last Change</td><td></td></tr></tbody></table></div><script src=/js/main.js></script>
<script src=/js/to-latex.js></script>
<script src=/js/background.js></script></body></html>